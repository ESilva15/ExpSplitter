<div>
  <form id="expense-form" action="submit">
    <fieldset id="form-box-boundaries">
      <legend>EXPENSE FORM</legend>
      <div class="form-container form-inline">
        <div id="form-state" class="warning"></div><br>

        {{ if eq .method "put" }}
        <p>
          <label for="expense-desc">ID:</label>
          <input 
            readonly
            class="tui-input underline fullwidth" type="text" name="expense-id" 
            value="{{ .expense.ExpID }}" id="expense-id"><br>
        </p>
        {{ end }}

        <p>
          <label for="expense-desc">Description:</label>
          <input 
            class="tui-input underline fullwidth" type="text" name="expense-desc" 
            value="{{ .expense.Description }}" id="expense-desc"><br>
        </p>

        <p>
          <label for="expense-date">Date:</label>
          <input 
            class="tui-input underline fullwidth" type="text" name="expense-date" 
            value="{{ formatDate .expense.ExpDate }}" id="expense-date"><br>
        </p>

        <p>
          <label for="expense-value">Value:</label>
          <input 
            class="tui-input underline fullwidth" type="text" name="expense-value" 
            value="{{ .expense.Value }}" id="expense-value"><br>
        </p>
        <br>

        <p>
          <label for="newexp-type-dropdown">Type:</label>
          <select name="newexp-type-dropdown" id="newexp-type-dropdown">
            {{ range .types }}
            <option 
              {{ if eq .TypeID $.expense.ExpType.TypeID }}selected{{ end }}
              value="{{ .TypeID }}">{{ .TypeName }}</option>
            {{ end}}
          </select>
        </p>

        <p>
          <label for="newexp-cat-dropdown">Category:</label>
          <select name="newexp-cat-dropdown" id="newexp-cat-dropdown">
            {{ range .categories }}
            <option 
              {{ if eq .CategoryID $.expense.ExpCategory.CategoryID }}selected{{ end }}
              value="{{ .CategoryID }}">{{ .CategoryName }}</option>
            {{ end}}
          </select>
        </p>

        <p>
          <label for="newexp-store-dropdown">Store:</label>
          <select name="newexp-store-dropdown" id="newexp-store-dropdown">
            {{ range .stores }}
            <option 
              {{ if eq .StoreID $.expense.ExpStore.StoreID }}selected{{ end }}
              value="{{ .StoreID }}">{{ .StoreName }}</option>
            {{ end}}
          </select>
        </p>
        <br>

        <p>
          <button
            type="button"
            onclick="addShareRow()"
            >+ Share</button>
        </p>
        <table>
          <tr>
            <th>USER</th>
            <th>SHARE</th>
            <th>PAYED</th>
          </tr>

          <tr id="default-payment-row">
            <td>
              <select name="shares-user-ids[]">
                {{ range .users }}
                <option 
                  {{ if eq .UserID $.expense.OwnerUser.UserID }}selected{{ end }}
                  value="{{ .UserID }}">{{ .UserName }}</option>
                {{ end}}
              </select>
            </td>
            <td>
              <input type="number" name="shares-percent[]" value="1">
            </td>
            <td>
              <input type="number" name="payments-payment[]" value="0">
            </td>
            <td class="row-delete-button">
              <button type="button" onclick="deleteShareRow(this)">X</button>
            </td>
          </tr>
          {{ range .summary }}
            {{ $summary := . }}
            <tr>
              <td>
                <select name="shares-user-ids[]">
                  {{ range $.users }}
                  <option 
                    value="{{ .UserID }}"
                    {{ if eq .UserID $summary.User.UserID }}selected{{ end }}>
                    {{ .UserName }}
                  </option>
                  {{ end }}
                </select>
              </td>
              <td>
                <input type="number" name="shares-percent[]" value="{{ $summary.Share }}">
              </td>
              <td>
                <input type="number" name="payments-payment[]" value="{{ $summary.PayedTotal }}">
              </td>
              <td class="row-delete-button">
                <button type="button" onclick="deleteShareRow(this)">X</button>
              </td>
            </tr>
          {{ end }}
        </table>
        <br><br>

        <button 
          class="subbutton"
          {{ if eq .method "put" }}
          hx-put="/expenses/{{ .expense.ExpID }}" 
          {{ end }}
          {{ if eq .method "post" }}
          hx-post="/expenses/new" 
          {{ end }}
          hx-swap="none"
          type="submit" 
          id="expense-submit-button">
          {{- if eq .method "put" }}UPDATE{{- end }}
          {{- if eq .method "post" }}CREATE{{- end }}</button>
      </div>
    </fieldset>
  </form>
</div>

<script>
  function deleteShareRow(btn) {
    const row = btn.closest("tr");
    if (row) {
      row.remove();
    }
  }
</script>

-- TODO
-- Check why sqlc doesn't correctly parse all my migrations
-- This should only be a workaround :c

CREATE TABLE categories (
  "CategoryID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "CategoryName" TEXT NOT NULL
);

CREATE TABLE "expenseTypes" (
  "TypeID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "TypeName" TEXT NOT NULL
);

CREATE TABLE stores (
  "StoreID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "StoreName" TEXT NOT NULL
);

CREATE TABLE users (
  "UserID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "UserName" TEXT NOT NULL,
  "UserPass" TEXT NOT NULL
);

CREATE TABLE expenses (
  "ExpID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Description" TEXT NOT NULL,
  "Value" NUMERIC(12,2) NOT NULL DEFAULT 0,
  "StoreID" INT NOT NULL DEFAULT 0,
  "CategoryID" INT NOT NULL DEFAULT 0,
  "OwnerUserID" INT NOT NULL DEFAULT 0,
  "TypeID" INT NOT NULL DEFAULT 0,
  "ExpDate" TIMESTAMP NOT NULL,
  "CreationDate" TIMESTAMP NOT NULL,
  "PaidOff" BOOLEAN DEFAULT FALSE,
  "SharesEven" BOOLEAN DEFAULT FALSE,
  FOREIGN KEY ("StoreID") REFERENCES stores("StoreID") ON DELETE RESTRICT,
  FOREIGN KEY ("CategoryID") REFERENCES categories("CategoryID") ON DELETE RESTRICT,
  FOREIGN KEY ("OwnerUserID") REFERENCES users("UserID") ON DELETE RESTRICT,
  FOREIGN KEY ("TypeID") REFERENCES "expenseTypes"("TypeID") ON DELETE RESTRICT
);

CREATE TABLE "expensesPayments" (
  "ExpPaymID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "ExpID" INT NOT NULL,
  "UserID" INT NOT NULL,
  "Payed" NUMERIC(12,2) NOT NULL DEFAULT 0,
  FOREIGN KEY ("ExpID") REFERENCES expenses("ExpID") ON DELETE RESTRICT,
  FOREIGN KEY ("UserID") REFERENCES users("UserID") ON DELETE RESTRICT
);

CREATE TABLE "expensesShares" (
  "ExpShareID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "ExpID" INT NOT NULL,
  "UserID" INT NOT NULL,
  "Share" NUMERIC(6,2) NOT NULL DEFAULT 0.5,
  "Calculated" NUMERIC(12,2) NOT NULL DEFAULT 0,
  FOREIGN KEY ("ExpID") REFERENCES expenses("ExpID") ON DELETE RESTRICT,
  FOREIGN KEY ("UserID") REFERENCES users("UserID") ON DELETE RESTRICT
);

CREATE TABLE schema_migrations (
  version BIGINT PRIMARY KEY,
  dirty BOOLEAN
);
